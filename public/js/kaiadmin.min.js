"use strict";

var logoHeaderContent = $(".sidebar .logo-header").html();

function layoutsColors() {
    $(".sidebar").is("[data-background-color]")
        ? $("html").addClass("sidebar-color")
        : $("html").removeClass("sidebar-color");
}

function customBackgroundColor() {
    $('*[data-background-color="custom"]').each(function () {
        $(this).is("[custom-color]")
            ? $(this).css("background", $(this).attr("custom-color"))
            : $(this).is("[custom-background]") && $(this).css("background-image", "url(" + $(this).attr("custom-background") + ")");
    });
}

function legendClickCallback(e) {
    e = e || window.event;
    var s = e.target || e.srcElement;
    while (s.nodeName !== "LI") s = s.parentElement;
    var a = s.parentElement;
    var o = parseInt(a.classList[0].split("-")[0], 10);
    var r = Chart.instances[o];
    var l = Array.prototype.slice.call(a.children).indexOf(s);
    r.legend.options.onClick.call(r, e, r.legend.legendItems[l]);
    r.isDatasetVisible(l) ? s.classList.remove("hidden") : s.classList.add("hidden");
}

function readURL(e) {
    if (e.files && e.files[0]) {
        var s = new FileReader();
        s.onload = function (s) {
            $(e).parent(".input-file-image").find(".img-upload-preview").attr("src", s.target.result);
        };
        s.readAsDataURL(e.files[0]);
    }
}

function showPassword(e) {
    var s = $(e).parent().find("input");
    s.attr("type") === "password" ? s.attr("type", "text") : s.attr("type", "password");
}

$(".main-header .logo-header").html(logoHeaderContent);

$(".nav-search .input-group > input")
    .focus(function () { $(this).parents().eq(2).addClass("focus"); })
    .blur(function () { $(this).parents().eq(2).removeClass("focus"); });

$(function () {
    let tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    [...tooltips].map(e => new bootstrap.Tooltip(e));

    let popovers = document.querySelectorAll('[data-bs-toggle="popover"]');
    [...popovers].map(e => new bootstrap.Popover(e));

    layoutsColors();
    customBackgroundColor();
});

$(document).ready(function () {
    $(".btn-refresh-card").on("click", function () {
        var e = $(this).parents(".card");
        if (e.length) {
            e.addClass("is-loading");
            setTimeout(function () { e.removeClass("is-loading"); }, 3000);
        }
    });

    var scrollableElements = [
        ".sidebar .scrollbar", ".main-panel .content-scroll", ".messages-scroll", ".tasks-scroll",
        ".quick-scroll", ".message-notif-scroll", ".notif-scroll", ".quick-actions-scroll",
        ".dropdown-user-scroll"
    ];


    $("#search-nav").on("shown.bs.collapse", function () {
        $(".nav-search .form-control").focus();
    });

    var toggles = [
        { selector: ".sidenav-toggler", className: "nav_open", state: "h" },
        { selector: ".quick-sidebar-toggler", className: "quick_sidebar_open", state: "m" },
        { selector: ".topbar-toggler", className: "topbar_open", state: "v" },
        { selector: ".toggle-sidebar", className: "sidebar_minimize", state: "f" },
        { selector: ".page-sidebar-toggler", className: "pagesidebar_open", state: "b" }
    ];

    toggles.forEach(toggle => {
        var el = $(toggle.selector);
        if (el.length) {
            el.on("click", function () {
                var state = window[toggle.state];
                state ? $("html").removeClass(toggle.className) : $("html").addClass(toggle.className);
                el.toggleClass("toggled");
                window[toggle.state] = !state;
            });
        }
    });

    $(".nav-item a").on("click", function () {
        $(this).parent().toggleClass("submenu", !$(this).parent().find(".collapse").hasClass("show"));
    });

    $(".messages-contact .user a").on("click", function () {
        $(".tab-chat").addClass("show-chat");
    });

    $(".messages-wrapper .return").on("click", function () {
        $(".tab-chat").removeClass("show-chat");
    });

    $('[data-select="checkbox"]').change(function () {
        var e = $(this).attr("data-target");
        $(e).prop("checked", $(this).prop("checked"));
    });

    $(".form-group-default .form-control")
        .focus(function () { $(this).parent().addClass("active"); })
        .blur(function () { $(this).parent().removeClass("active"); });
});

$('.input-file-image input[type="file"]').change(function () { readURL(this); });

$(".show-password").on("click", function () { showPassword(this); });

var containerSignIn = $(".container-login");
var containerSignUp = $(".container-signup");
var showSignIn = true;
var showSignUp = false;

function changeContainer() {
    containerSignIn.css("display", showSignIn ? "block" : "none");
    containerSignUp.css("display", showSignUp ? "block" : "none");
}

$("#show-signup").on("click", function () {
    showSignUp = true;
    showSignIn = false;
    changeContainer();
});

$("#show-signin").on("click", function () {
    showSignUp = false;
    showSignIn = true;
    changeContainer();
});

changeContainer();

$(".form-floating-label .form-control").keyup(function () {
    $(this).val() !== "" ? $(this).addClass("filled") : $(this).removeClass("filled");
});
